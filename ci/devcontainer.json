# Base image with Python
FROM python:3.11-slim

# Install dependencies needed for ops-utilities scripts
RUN apt-get update && apt-get install -y \
    git \
    openssl \
    bash \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Copy repo content (assumes devcontainer is in root of repo)
COPY . .

# Make all shell scripts executable
RUN chmod +x *.sh scripts/*.sh ci/*.sh

# Set up Python virtual environment inside container
RUN python -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"

# Upgrade pip in virtualenv
RUN pip install --upgrade pip

# Run initialization script to check environment & generate changelog
RUN ./init_environment.sh

# Default command to keep container running
CMD [ "bash" ]
